<!-- rock paper scissors practice experiment -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Replication Experiment</title>

  <!-- jsPsych core + plugins -->
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-likert@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@2.1.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" />
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
</head>

<body>
    <div id="scoreboard" style="
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: blue;
        border: 2px solid black;
        border-radius: 8px;
        padding: 10px;
        color: white;
        font-family: sans-serif;
        z-index: 1000;">
        <strong>Player Earnings</strong><br>
        You: <span id="player-score">0</span><br>
        <span id="opponent-label">Opponent</span>: <span id="computer-score">0</span>
    </div>


</body>

<script>
  // Initialize jsPsych
  var jsPsych = initJsPsych();

  var timeline = [];
  let participantName = "";

    // Generate random subject ID for data filename
    const subject_id = jsPsych.randomization.randomID(10);
    jsPsych.data.addProperties({ subject_id: subject_id });
    const filename = `${subject_id}.csv`;
            
  // --- Preload images ---
  var preload = {
    type: jsPsychPreload,
    images: [
      "exp_code/Images/Rock_Computer.png",
      "exp_code/Images/Rock_Participant.png",
      "exp_code/Images/Paper_Computer.png",
      "exp_code/Images/Paper_Participant.png",
      "exp_code/Images/Scissors_Computer.png",
      "exp_code/Images/Scissors_Participant.png",
      "exp_code/Images/Loading_icon.gif", 
    ]
  };
  timeline.push(preload);


//consent form

  var consent ={
    type: jsPsychHtmlButtonResponse,
    stimulus: `
    <p style = "text-align: start; margin-right: 50px; margin-left: 50px"> You are being invited to participate in a research study titled “Reproducibility of Psychological Science and Instruction.”<br><br>This study is being done by Dr. Bria Long from UC San Diego and associated graduate students in Experimental Methods course.<br><br>You were selected to participate in this study because you are an adult in the U.S. and have been a represented population in previous psychology studies.
    The purpose of this study is to better understand how well previously published studies in the psychological field replicate online and with different populations. Your participation in this research should last approximately 5-30 minutes  If you agree to take part in this study, you may be asked to view a set of stimuli, including pictures, sounds, written text, or videos and then giving some responses via key-presses, verbally, or with paper-and-pencil. We may also observe your choices or preferences among an array of stimuli.  These stimuli will be taken directly from or closely adapted from studies that already exist in the published psychological literature. Stimuli will include, e.g., pictures of objects and human faces, audio and video clips, short text passages, etc. None of the stimuli will be disturbing, threatening, or offensive. The online and in-person experiments described in this protocol will take no more than 30 minutes. An example game you might play would be to click on an image on the screen that matches a word you hear being said out loud. Your total expected time commitment for this study is between 5-30 minutes, and is specified in the study description.
    Your participation in this study is completely voluntary and you can withdraw at any time. Choosing not to participate or withdrawing will result in no penalty or loss of benefits to which you are entitled. You are free to skip any question that you choose.
    We will not be asking for any personally identifying information, and we will handle responses as confidentially as possible. Your SONA or Prolific IDs will never be tied to your responses on this survey. However, we cannot guarantee the confidentiality of information transmitted over the Internet. To minimize this risk, data containing anything that might be personally identifiable (e.g. Prolific IDs or IP addresses) will be encrypted on transfer and storage and will only be accessible to qualified lab personnel. We will be keeping data collected as part of this experiment indefinitely. This anonymized data (containing neither Prolific IDs nor IP addresses) may be shared with the scientific community or with other participants to be used as stimuli in future studies.<br><br>
    If you have questions about this project or if you have a research-related problem, you may contact the researcher(s),  Dr. Bria Long, brlong@ucsd.edu. If you have any questions concerning your rights as a research subject, you may contact the UC San Diego Office of IRB Administration at irb@ucsd.edu or 858-246-4777. <br><br>
    By participating in this research you are indicating that you are at least 18 years old, have read this consent form, and agree to participate in this research study. Please keep this consent form for your records. </p>`,
    choices: ['I Consent', 'I Do Not Consent'],
    data: { task: 'consent' },
    on_finish: function(data){
      if(data.response === 1){
        jsPsych.data.addProperties({ reason: "participant_declined_consent" }); //log reason for non-consent
        
        document.body.innerHTML = `
        <div style="text-align:center; margin-top:100px;">
          <h3>You have chosen not to participate in this study.</h3>
          <p>Thank you for your time. You may now close this window.</p>
          <p>Or, you will be automatically redirected in 5 seconds.</p>
        </div>
      `;

      // delay redirect
      setTimeout(function() {
        window.location.href = "https://irb.ucsd.edu/participants/index.html";
      }, 5000);

      // return false prevents jsPsych from continuing the timeline
      return false;
    }
  }
};
timeline.push(consent);
  
var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p style="text-align:start;">Thank you for choosing to participate. We are studying how people make decisions under uncertainty.</p>
               <p style="text-align:start;">You'll first play a quick game to test decision-making strategies. Your performance in this game will determine a small monetary bonus. <br>Afterwards, you'll complete a semantic categorization task to measure cognitive flexibility.<br>
               <p><i>Press any key to begin.</i></p>`
  };
  timeline.push(welcome);

  // get participant name/Psuedonym here if desired
  var participant_name = {
    type: jsPsychSurveyText,
    questions: [
      { prompt: `Please enter your name or a pseudonym to use during the game. <br><i>If you decide to use a pseudonym, we ask that you pick something respectful to the other player</i>.`, required: true }
  ],
  button_label: "Continue",
  on_finish: function(data){
    participantName = data.response.Q0;
    jsPsych.data.addProperties({ participant_name: participantName });
  }
  };
  timeline.push(participant_name);


    function computer_name() {
    var x = Math.floor(Math.random() * 5) + 1;
    if (x === 1) return "Megan";
    else if (x === 2) return "Bria";
    else if (x === 3) return "Thomas";
    else return "Jonathon";
  };
  const computerName = computer_name();

  // When the page loads, update the opponent label
    document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("opponent-label").textContent = computerName;
    });

  //explain the rules of the game here 
  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h2>Instructions</h2>
      <p style = "text-align: start">For this experiment, you will be randomly paired with another participant to play a game of rock, paper, scissors.</p>
      <p style = "text-align: start">You will first complete three practice rounds to get familiar with the game interface.</p>
      <p style = "text-align: start">The rules of the game are simple:</p>
      <ol style ="list-style-type=decimal; list-style-position:inside;padding-left:0; display=inline-block; text-align: start">
        <li>Rock crushes Scissors</li><li>Paper covers Rock</li><li>Scissors cut Paper</li>
      </ol>
      <p style = "text-align: start">After you select your move, there will be a short countdown before both choices are revealed.</p>
      <p style = "text-align: start">No points will be rewarded for the practice round. After three rounds, the real round of rock, paper, scissors will begin.</p>
      <p style = "text-align: start"><b>The winner of the real round will receive a monetary reward of $XX.</b></p>
      <p><i>Press any key to begin the practice rounds.</i></p>
    `
  };
  timeline.push(instructions);

    var pairing_intro = {
    type: jsPsychHtmlKeyboardResponse,
    choices: "NO KEYS",
    stimulus: `<div style="text-align:center;">
               <p><b>...Pairing...</b></p>
               <p style = "font-size:small"> Finding a partner to pair you with </p>
               <img src ="exp_code/Images/Loading_icon.gif" width='200' alt='Loading...'>
               </div>
               `, 
    trial_duration: 2000 // 2 second delay to simulate pairing process
    };
    timeline.push(pairing_intro);

  var introductions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p>Your opponent for this game is <b>${computerName}</b>. Good luck!</p>
               <p><i>Press any key to continue.</i></p>`
  };
  timeline.push(introductions);

  // --- Game setup ---
  var participant_images = {
    'Rock': 'exp_code/Images/Rock_Participant.png',
    'Paper': 'exp_code/Images/Paper_Participant.png',
    'Scissors': 'exp_code/Images/Scissors_Participant.png'
  };

  var computer_images = {
    'Rock': 'exp_code/Images/Rock_Computer.png',
    'Paper': 'exp_code/Images/Paper_Computer.png',
    'Scissors': 'exp_code/Images/Scissors_Computer.png'
  };

  var choices = ['Rock', 'Paper', 'Scissors'];

  function determineWinner(player, computer) {
    if (player === computer) return "tie";
    if (
      (player === "Rock" && computer === "Scissors") ||
      (player === "Paper" && computer === "Rock") ||
      (player === "Scissors" && computer === "Paper")
    ) return "player";
    return "computer";
  }

  // --- 3 practice rounds ---
  for (let i = 0; i < 3; i++) {

    // Player choice screen
    let player_choice = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p><b>Round ${i + 1}</b><br>Choose your move:</p>`,
      choices: [
        `<img src='${participant_images["Rock"]}' width='300'>`,
        `<img src='${participant_images["Paper"]}' width='300'>`,
        `<img src='${participant_images["Scissors"]}' width='300'>`
      ],
      data: { round: i + 1 },
      on_finish: function(data) {
        let choice_index = data.response;
        data.player_choice = choices[choice_index];
      }
    };

    // Other participant choice delay 
    let computer_delay = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p>Waiting for ${computerName} to choose...</p>`,
      choices: "NO_KEYS",
      trial_duration: Math.floor(Math.random() * 1000) + 1000 // random delay between 1-2 seconds
    };

    // Countdown screen
    let delay_before_reveal = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p style="font-size:48px; font-weight:bold;">3...</p>`,
      choices: "NO_KEYS", // disable keypresses
      trial_duration: 3200, // total duration of countdown ~ 3 seconds
      on_load: function() {
        const display = document.querySelector('.jspsych-content');
        setTimeout(() => display.innerHTML = `<p style="font-size:48px; font-weight:bold;">2...</p>`, 1000);
        setTimeout(() => display.innerHTML = `<p style="font-size:48px; font-weight:bold;">1...</p>`, 2000);
        setTimeout(() => display.innerHTML = `<p style="font-size:48px; color:green; font-weight:bold;">Go!</p>`, 2800);
      }
    };

    // Show results
    let show_result = {
      type: jsPsychHtmlKeyboardResponse,
      choices: "ALL_KEYS",
      stimulus: function() {
        let last_trial = jsPsych.data.get().last(3).values()[0]; //get player choice 3 trials back
        let player = last_trial.player_choice;
        let computer = jsPsych.randomization.sampleWithoutReplacement(choices, 1)[0];
        let result = determineWinner(player, computer);

        jsPsych.data.addDataToLastTrial({
          computer_choice: computer,
          result: result
        });

        let html = `
          <div style="display:flex; justify-content:center; align-items:center; gap:60px;">
            <div style="text-align:center;">
              <p><b>${participantName} chose:</b></p>
              <img src='${participant_images[player]}' width='300'>
            </div>
            <div style="text-align:center;">
              <p><b>${computerName} chose:</b></p>
              <img src='${computer_images[computer]}' width='300'>
            </div>
          </div>
        `;

        if (result === "tie") {
          html += `<p style="font-size:24px;"><b>It's a tie!</b></p>`;
        } else if (result === "player") {
          html += `<p style="font-size:24px; color:green;"><b>${participantName} wins this round!</b></p>`;
        } else {
          html += `<p style="font-size:24px; color:red;"><b>${computerName} wins this round!</b></p>`;
        }

        html += `<p style='font-size:small;'>Press any key to continue.</p>`;
        return html;
      }
    };

    timeline.push(player_choice, computer_delay, delay_before_reveal, show_result);
  }

  // End message
  var cognition_check = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <h1 style = "text-align: center"><b>Practice rounds complete!</b></h1>
      <p style = "text-align: start">Now that you have finished the practice rounds, do you feel like you understand how to play Rock, Paper, Scissors?</p>
      <p style = "text-align: start">If not, the instructions will be displayed again before the main game.</p>
    `, 
    choices: ['Yes', 'No']
  };
  timeline.push(cognition_check);

  //real round for money would go here: 
    // need to randomly place participant in winner and loser conditions
    //scoreboard will go here too
    var main_game_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
        <h2>Final Round Instructions</h2>
        <p style = "text-align: start">You will now proceed to the <b>final round</b> of Rock, Paper, Scissors against ${computerName}.</p>
        <p style = "text-align: start">Remember the winner of the round will receive a reward of $XXX.</p>
        <p style = "text-align: start">If there is a tie, the round will be replayed until there is a winner.</p>
        <p style = "text-align: start"> In case you forgot, the rules are below: </p>
        <ol style ="list-style-type=decimal; list-style-position:inside;padding-left:10px; display=inline-block; text-align: start">
            <li>Rock crushes Scissors</li><li>Paper covers Rock</li><li>Scissors cut Paper</li></ol>
        <p style = "text-align: start">Good luck!</p>
        <p><i>Press any key to begin the final round.</i></p>
        `, 
        on_finish: function() {
            // show scoreboard
            document.getElementById('scoreboard').style.display = 'block';
        }
    };
    timeline.push(main_game_instructions);

    //create random assignment to conditions 
    var random_condition = jsPsych.randomization.sampleWithoutReplacement(['winner', 'loser'], 1)[0];
    jsPsych.data.addProperties({random_condition: random_condition});
    
    //main game code below 
    var main_game = {
    timeline: [

        // Player makes a choice
        {
        type: window.jsPsychHtmlButtonResponse,
        stimulus: `<p><b>Main Game</b><br>Choose your move:</p>`,
        choices: [
            `<img src='${participant_images["Rock"]}' width='300'>`,
            `<img src='${participant_images["Paper"]}' width='300'>`,
            `<img src='${participant_images["Scissors"]}' width='300'>`
        ],
        on_finish: function(data) {
            data.player_choice = choices[data.response];
        }
        },
        // Waiting screen for other participant
        {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `<p>Waiting for ${computerName} to choose...</p>`,
        choices: "NO_KEYS",
        trial_duration: Math.floor(Math.random() * 1000) + 1000 // random delay between 1-2 seconds
        },
        // Reuse countdown
        {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `<p style="font-size:48px; font-weight:bold;">3...</p>`,
        choices: "NO_KEYS", // disable keypresses
        trial_duration: 3200, // total duration of countdown ~ 3 seconds
        on_load: function() {
            const display = document.querySelector('.jspsych-content');
            setTimeout(() => display.innerHTML = `<p style="font-size:48px; font-weight:bold;">2...</p>`, 1000);
            setTimeout(() => display.innerHTML = `<p style="font-size:48px; font-weight:bold;">1...</p>`, 2000);
            setTimeout(() => display.innerHTML = `<p style="font-size:48px; color:green; font-weight:bold;">Go!</p>`, 2800);
        }
        },

        // Show result (with manipulation)
        {
        type: jsPsychHtmlKeyboardResponse,
        choices: "ALL_KEYS",
        stimulus: function() {
            let last_trial = jsPsych.data.get().last(3).values()[0];
            let player = last_trial.player_choice;
            let computer;
            let result;

            // --- Manipulate outcome based on condition ---
            if (random_condition === "winner") { //create win condition such that participant always wins
            if (player === "Rock") computer = "Scissors";
            else if (player === "Paper") computer = "Rock";
            else computer = "Paper";
            result = "player";
            } else { //create lose condition such that participant always loses
            if (player === "Rock") computer = "Paper";
            else if (player === "Paper") computer = "Scissors";
            else computer = "Rock";
            result = "computer";
            }

            // Save data
            jsPsych.data.addDataToLastTrial({
            computer_choice: computer,
            result: result
            });
            // Trigger confetti around the winner's side
            setTimeout(() => {
                if (result === "player") {
                    confetti({
                        particleCount: 150,
                        spread: 100,
                        origin: { x: 0.3, y: 0.6 } // left side (player)
                    });
                } else if (result === "computer") {
                    confetti({
                        particleCount: 150,
                        spread: 100,
                        origin: { x: 0.7, y: 0.6 } // right side (computer)
                    });
                }
            }, 200);
            // Display results 
            let html = `
            <div style="display:flex; justify-content:center; align-items:center; gap:60px;">
                <div style="text-align:center;">
                <p><b>${participantName} chose:</b></p>
                <img src='${participant_images[player]}' width='300'>
                </div>
                <div style="text-align:center;">
                <p>${computerName} chose:</b></p>
                <img src='${computer_images[computer]}' width='300'>
                </div>
            </div>
            `;
            //title results 
            if (result === "player") {
            html += `<p style="font-size:24px; color:green;"><b>${participantName} wins this round!</b> ${participantName} wins $XX.</p>`;
            } else {
            html += `<p style="font-size:24px; color:red;"><b>${computerName} wins this round!</b> ${computerName } wins $XX.</p>`;
            }

            
            //change scoreboard with currency earnings here 
            if (result === "player") {
                let playerScoreEl = document.getElementById('player-score');
                let current = parseFloat(playerScoreEl.textContent.replace('$', '')) || 0;
                playerScoreEl.textContent = `$${(current + 5).toFixed(2)}`;} 
                else if (result === "computer") {
                    let computerScoreEl = document.getElementById('computer-score');
                    let current = parseFloat(computerScoreEl.textContent.replace('$', '')) || 0;
                    computerScoreEl.textContent = `$${(current + 5).toFixed(2)}`;
                }

            html += `<p><i>Press any key to continue.</i></p>`;
            return html;
        }
        },
    ],
    };

    timeline.push(main_game);



    var attention_check = {
    type: window.jsPsychHtmlButtonResponse, 
    stimulus: "<p>Who won the last round you played?</p>", 
    choices: ['You', `${computerName}`, 'It was a tie']
    };
    timeline.push(attention_check);

    //filler task --> semantic categorization task
    var filler_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p style = "text-align: start; margin-left: 20px; margin-right: 20px"> Thank you! Now, you will complete a short task to measure cognitive flexibility.</p>
        <p style = "text-align: start; margin-left: 20px; margin-right: 20px"> In this task, you will see a set of 10 words. Your job is to select which category the set of words belong to.</p>
        <p style = "text-align: start; margin-left: 20px; margin-right: 20px"> For example, if the set of words are: 
        <br><br> Dog, Cat, Elephant, Tiger, Lion, Bear, Wolf, Fox, Giraffe, Zebra <br><br> 
        a. Animals<br>b. Colors<br> c. Names <br> d. Pets<br><br>
        You would select "Animals" from the multiple choice list as the category.</p>
        <p><i> Press any key to begin the task.</i></p>
    `
    };
    timeline.push(filler_instructions);

    var filler_task = {
      type: jsPsychSurveyMultiChoice, 
      questions: [
        {
          prompt: "Which category do these words belong to? <br>Apple, Orange, Pear, Banana, Peach, Grape, Cherry, Plum, Grapefruit, Lemon",
          options: [
            "Fruits",
            "Vegetables",
            "Animals",
            "Countries"
          ],
          required: false,
          horizontal: false
        }, 
        {
          prompt: "Which category do these words belong to? <br>Diamond, Ruby, Emerald, Sapphire, Pearl, Opal, Jade, Topaz, Amethyst, Onyx",  
          options: [
            "Colors",
            "Jewels",
            "Metals",
            "Planets"
          ],
          required: false,
          horizontal: false
        },
        {
          prompt: "Which category do these words belong to? <br>Aunt, Uncle, Father, Mother, Brother, Sister, Cousin, Grandfather, Grandmother, Nephew",  
          options: [
            "Family Members",
            "Friends",
            "Colleagues",
            "Neighbors"
          ],
          required: false,
          horizontal: false
        }, 
        {
          prompt: "Which category do these words belong to? <br>Legs, Arms, Head, Eye, Mouth, Nose, Finger, Ear, Hand, Toe",  
          options: [
            "Animals",
            "Plants",
            "Body Parts",
            "Fruits"
          ],
          required: false,
          horizontal: false
        }, 
        {
          prompt: "Which category do these words belong to? <br>Knife, Spoon, Fork, Pan, Pot, Spatula, Cup, Stove, Bowl, Mixer",  
          options: [
            "Furniture",
            "Appliances",
            "Vehicles",
            "Kitchen Utensils"
          ],
          required: false,
          horizontal: false
        }, 
      ],
      button_label: "Continue.", 
      randomize_question_order: true
    };
    timeline.push(filler_task);
        
  //measures for manipulation check and demographics would go here
    var appraisal_of_situation = {
        type: jsPsychSurveyLikert,
        preamble: `<div style = "margin-top: 50px; margin-left: 50px; margin-right: 50px">
        <h3>Please respond to the following statements by selecting the choice that reflects how you feel about the outcome of Rock, Paper, Scissors.</h3>
        </div>`,
        questions: [
            {prompt: "", labels: ["The outcome was unfair to me.", "", "", "","","", "The outcome was fair to me."], required: false},
            {prompt: "", labels: ["The outcome of the situation was unjust.", "", "", "","","", "The outcome of the situation was just."], required: false}, 
            {prompt: "", labels: ["The other person deserved the outcome of the situation.", "", "", "","","", "The other person did not deserve the outcome of the situation."], required: false}, 
            {prompt: "", labels: ["The outcome of the situation was unfavorable to me.", "", "", "","","", "The outcome of the situation was favorable to me."], required: false}, 
            {prompt: "", labels: ["The outcome of the situation was important to me.", "", "", "","","", "The outcome of the situation was not important to me."], required: false}, 
            {prompt: "", labels: ["I deserved the outcome of the situation.", "", "", "","","", "I did not deserve the outcome of the situation."], required: false}, 
            {prompt: "", labels: ["The outcome of the situation was pleasant for me.", "", "", "","","", "The outcome of the situation was unpleasant for me."], required: false}, 
            {prompt: "", labels: ["The outcome of the situation was uncontrollable.", "", "", "","","", "The outcome of the situation was controllable."], required: false}, 
            {prompt: "", labels: ["The outcome of the situation could have been different", "", "", "","","", "The outcome of the situation could not have been different."], required: false},
            {prompt: "", labels: ["The reward is attractive.", "", "", "","","", "The reward is unattractive."], required: false}
        ], 
        scale_width: 600,
        button_label: "Continue."
    }
    timeline.push(appraisal_of_situation);
    //check the state emotion phrasings...
    var state_emotions = {
    type: jsPsychSurveyLikert,
    preamble:  `<div style = "margin-top: 50px; margin-left: 50px; margin-right: 50px">
      <h3>For the list below, please indicate how strongly you feel these emotions towards ${computerName}.</h3>
      </div>`,
    questions: [
        {prompt: "I am satisfied with myself.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I am jealous of that person.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I admire that person.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I feel worthless.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I feel envious of that person.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I feel resentment.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false}, 
        {prompt: "I feel jealous.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false}, 
        {prompt: "I feel shame.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I feel envy.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
    ], 
    scale_width: 600,
    button_label: "Continue."
    };
    timeline.push(state_emotions);

    var outcome_attribution = {
    type: jsPsychSurveyMultiChoice,
    questions: [
        {
        prompt: "What do you attribute the result in the Rock, Paper, Scissors game to?<br><i>Please choose one of the four options below.</i>",
        options: [
            "My luck during the game.", 
            "The difficulty of the task.",
            "The other player's skill level.",
            "The other person's effort during the game."
        ], 
        required: false,
        horizontal: false, 
        button_label: "Continue."
        }
    ],
    }
    timeline.push(outcome_attribution);

    var BIDR = {
    type: jsPsychSurveyLikert,
    preamble: `
    <div style = "margin-top: 50px; margin-left: 50px; margin-right: 50px">
    <h3>Please respond to the following statements by selecting the choice that reflects how you generally tend to feel.</h3>
    </div>`,
    questions: [
        {prompt: "The first impression I get of other people usually turns out to be true.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I haven't always been honest with myself.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I always know why I like something.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I find it difficult to push disturbing thoughts aside.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "Sometimes I miss out on something because I simply can't make up my mind quickly enough.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I am a completely rational thinker.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I rarely tolerate criticism.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I am very confident in my judgments.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I have occasionally doubted my abilities as a lover.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I don't always know the reasons for my actions.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I sometimes tell lies when I have to.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "There have been times when I have taken advantage of someone.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I never swear.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "Sometimes I prefer to get even with others than forgive and forget.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I have taken too much change without telling the salesperson.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I always declare everything I have to declare at customs.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "Sometimes I drive faster than the speed limit.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I have done things that I don't tell others about.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I never take things that don't belong to me.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "I have skipped work or school because of a 'supposed' illness.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
    ], 
    scale_width: 600,
    button_label: "Continue."
    };
    timeline.push(BIDR);

    var DSES = {
    type: jsPsychSurveyLikert,
    preamble: `<div style = "margin-top: 50px; margin-left: 50px; margin-right: 50px">
    <h3>Please respond to the following statements by selecting the choice that reflects how you generally tend to feel.</h3>
    </div>`,
    questions: [
        {prompt: "It bothers me when people seem to be able to have any partner they want.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It's hard to bear when other people are more intelligent than me.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It bothers me when others have things that I can't have.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It makes me uncomfortable when others are more attractive than me.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It bothers me when others can express themselves better than I can.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It's hard for me to bear when others can buy everything they want.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It consumes me when others are more popular than I am.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It bothers me when people are more creative than I am.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It torments me when others have better technical equipment than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It bothers me when people get along better with others than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It gnaws at me when when others grasp a situation faster than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It's hard for me to bear when others have a fuller wardrobe than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It eats away at me when people are more popular with others than I am.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It bothers me when others have more general knowledge than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
        {prompt: "It gnaws at me when others live in a better neighborhood than I do.", labels:["Strongly disagree", "Moderately disagree", "Disagree a little", "Neither agree nor disagree", "Agree a little", "Moderately agree", "Strongly agree"], required: false},
    ], 
    scale_width: 600,
    button_label: "Continue."
    };
    timeline.push(DSES);

    //demographics here 
    var gender_question = {
    type: jsPsychSurveyMultiChoice,
    questions: [
        {
        prompt: "Please select the term below which best describes your gender identity",
        options: [
            "Male", "Female", "Non-binary", "My gender identity is not listed here", "Prefer not to say"
        ], 
        required: false, 
        }
    ],
    button_label: "Continue."
    };
    timeline.push(gender_question);

    var age_question = {
    type: jsPsychSurveyText,
    questions: [
        { prompt: "What is your age in years?", required: false }
    ],
    button_label: "Continue."
    };
    timeline.push(age_question);

    var attention_check_2 = {
    type: jsPsychSurveyLikert,
    preamble: "<h3>Attention Check</h3>",
    questions: [
        {prompt: "How much attention did you pay to the questions in this study", labels:["Almost none", "Very little", "Some", "A lot", "Almost all"], required: false}
    ],
    scale_width: 600,
    button_label: "Continue."
    };
    timeline.push(attention_check_2);

    var funnel = {
    type: jsPsychSurveyText,
    questions: [
      {prompt: "What do you think this survey is about?", name: "funnel_1", required: false, rows: 5 },
      {prompt: "What hypothesis/hypotheses do you think we were testing in this study?", name: "funnel_2", required: false, rows: 5 },
      {prompt: "If you have any comments about the study, please write them below:", name: "comments", required: false , rows:5 }
    ],
    };
    timeline.push(funnel);

    //debrief here 
    var debrief = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <h2 style = "text-align: start; margin-right: 50px; margin-left: 50px">Thank you for participating in this study titled, Reproducibility of Psychological Science and Instruction.</h2>
        <p style = "text-align: start; margin-right: 50px; margin-left: 50px">We were interested in games with low external control influence feelings of envy. You played a rock, paper, scissors with another participant and either won a reward or not. Following this, you responded to emotion assessments regarding how you felt towards the person you played rock, paper, scissors with.
        <p style = "text-align: start; margin-right: 50px; margin-left: 50px">If other people knew the true purpose of the study, it might affect how they behave/answer questions, so we are asking you not to share the information we just discussed. </p><br>
        <p style = "text-align: start; margin-right: 50px; margin-left: 50px">Thank you for your participation!</p><br>
        <p><i>You may now close the tab.</i></p>
    `, 
      choices: "NO_KEYS",       // prevent manual advancement
    trial_duration: 30000,     // display for 30 seconds
    on_finish: function() {
        window.location.href = "about:blank";  // redirect to a blank page after 30 seconds
      }
    };
    timeline.push(debrief);

    // save data using jsPsych-Pipe
    const save_data = {
    type: jsPsychPipe,
    action: "save",
    experiment_id: "oDxchSd0ffjq",
    filename: filename,
     data_string: () => jsPsych.data.get().csv()  // now includes subject_id column
    };
  timeline.push(save_data)

  // Run the experiment
jsPsych.run(timeline)

</script>
</html>